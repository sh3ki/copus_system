<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Find Available Schedule Slots</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
:root {
    --primary-color-start: #0f2027; /* Dark blue */
    --primary-color-end: #203a43; /* Darker blue */
    --secondary-color-start: #2c5364; /* Blue-green */
    --secondary-color-end: #203a43; /* Darker blue */
    --text-light: #e0e0e0;
    --text-dark: #333;
    --sidebar-width: 280px;
    --accent-color: #17e891;
    --hover-color: rgba(255, 255, 255, 0.1);
    --border-color: rgba(255, 255, 255, 0.1);
    --card-bg: rgba(255, 255, 255, 0.05);
    --text-color: #e0e0e0;
}

body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, var(--primary-color-start), var(--primary-color-end));
    color: var(--text-light);
    min-height: 100vh;
}

/* ===== Header styles ===== */
header {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: fixed;
    top: 0;
    left: var(--sidebar-width);
    right: 0;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
}

.logo {
    display: flex;
    align-items: center;
    font-weight: 600;
    font-size: 1.5rem;
    color: #fff;
}
.logo img {
    height: 40px;
    margin-right: 15px;
}
.header-title {
    font-size: 1.25rem;
    color: var(--text-light);
    margin-left: -150px;
}
.header-icons {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}
.header-icons i {
    font-size: 1.5rem;
    color: var(--text-light);
    cursor: pointer;
    transition: color 0.3s;
}
.header-icons i:hover {
    color: #17e891;
}
.user-icon-circle {
    background: rgba(255, 255, 255, 0.2);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.25rem;
}

/* ===== Sidebar styles ===== */
.custom-sidebar {
    width: var(--sidebar-width);
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    background: linear-gradient(to bottom, #11405b, #0f2027);

    color: var(--text-light);
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
    z-index: 1001;
}
.custom-sidebar h6 {
    font-size: 1.2rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.25rem;
}
.custom-sidebar small {
    color: rgba(255, 255, 255, 0.6);
}
.custom-sidebar hr {
    border-color: rgba(255, 255, 255, 0.1);
    margin: 1.5rem 0;
}
.custom-sidebar a {
    color: var(--text-light);
    text-decoration: none;
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    transition: background 0.3s, color 0.3s;
    display: flex;
    align-items: center;
    gap: 1rem;
}
.custom-sidebar a i {
    font-size: 1.25rem;
}
.custom-sidebar a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #17e891;
}
.custom-sidebar a.active {
    background: linear-gradient(to right, #2c5364, #203a43);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    color: #fff;
}
.logout-btn {
    background: linear-gradient(to right, #e74c3c, #c0392b);
    border: none;
    color: #fff;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    text-align: left;
    width: 100%;
    font-weight: 600;
    transition: transform 0.2s;
}
.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

/* ===== Main content ===== */
.main-content {
    margin-left: var(--sidebar-width);
    padding: 7rem 2rem 2rem 2rem;
    flex-grow: 1;
    overflow-y: auto;
    margin-top: -100px;
}
.section-title, .page-title {
    font-size: 1.75rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 1.5rem;
}

/* ===== Card styles ===== */
.card, .custom-card {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    color: var(--text-light);
}

/* ===== Table styles ===== */
.custom-table {
    color: var(--text-color);
    border-collapse: separate;
    border-spacing: 0 10px;
}
.custom-table th, .custom-table td {
    border: none;
    vertical-align: middle;
    padding: 15px;
    background-color: rgba(255, 255, 255, 0.05);
    transition: background-color 0.3s ease;
}
.custom-table tbody tr:hover td {
    background-color: rgba(255, 255, 255, 0.1);
}
.custom-table thead th {
    background-color: var(--hover-color);
    color: #fff;
    border-bottom: 2px solid var(--accent-color);
    position: sticky;
    top: 0;
    z-index: 10;
}

/* ===== Buttons ===== */
.btn-select {
    background-color: var(--accent-color);
    border: none;
    color: #fff;
    font-weight: bold;
    padding: 8px 20px;
    border-radius: 20px;
    transition: background-color 0.3s ease, transform 0.2s ease;
}
.btn-select:hover {
    background-color: #16a085;
    transform: translateY(-2px);
}

/* ===== Modal ===== */
.modal-content {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.9) 0%, rgba(26, 82, 118, 0.9) 100%);
    color: var(--text-color);
    border: none;
    border-radius: 15px;
}
.modal-header {
    border-bottom: 1px solid var(--border-color);
}
.modal-footer {
    border-top: 1px solid var(--border-color);
}
.form-control, .form-select {
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--border-color);
    color: var(--text-color) !important;
}
.form-control:focus, .form-select:focus {
    background-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 0 0 0.25rem rgba(26, 188, 156, 0.25);
    border-color: var(--accent-color);
}
.form-control-plaintext {
    color: var(--text-color) !important;
    font-weight: 500;
}
.btn-close {
    filter: invert(1);
}

/* ===== Pagination ===== */
.pagination .page-item .page-link {
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--border-color);
    color: var(--text-color);
    transition: background-color 0.3s ease;
}
.pagination .page-item.active .page-link {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
    color: #fff;
}
.pagination .page-item .page-link:hover {
    background-color: var(--hover-color);
    color: #fff;
}

/* ===== Alerts ===== */
.alert-success {
    background-color: rgba(26, 188, 156, 0.3);
    border-color: var(--accent-color);
    color: var(--text-color);
}
.alert-danger {
    background-color: rgba(231, 76, 60, 0.3);
    border-color: #e74c3c;
    color: var(--text-color);
}

/* ===== FullCalendar styles ===== */
#calendar {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
}
.fc .fc-toolbar-title {
    color: var(--text-light);
    font-weight: 600;
    font-size: 1.5rem;
}
.fc .fc-button-group .fc-button {
    background-color: #2c5364;
    border-color: #2c5364;
    color: #fff;
}
.fc .fc-button-group .fc-button:hover {
    background-color: #3b7489;
}
.fc-theme-standard .fc-scrollgrid,
.fc-theme-standard td,
.fc-theme-standard th {
    border-color: rgba(255, 255, 255, 0.1);
}
.fc-day-header {
    color: #17e891;
    font-weight: 600;
}
.fc-daygrid-day-number {
    color: var(--text-light);
}
.fc-event-main-frame {
    padding: 5px;
    border-radius: 4px;
}
.fc-event {
    background-color: #17e891;
    border-color: #17e891;
    color: var(--text-dark);
    font-weight: 600;
    cursor: pointer;
}
.fc-event-title {
    white-space: normal;
}
.fc-event-main {
    font-size: 0.85rem;
    line-height: 1.2;
    padding: 5px;
}
.fc-event-scheduled {
    background-color: #3498db;
    border-color: #3498db;
}
.fc-event-completed {
    background-color: #9b59b6;
    border-color: #9b59b6;
}

/* ===== Legends ===== */
.legend-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    color: var(--text-light);
}
.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
}
.legend-color {
    width: 15px;
    height: 15px;
    border-radius: 3px;
}
.legend-color.available { background-color: #27ae60; }
.legend-color.scheduled { background-color: #3498db; }
.legend-color.completed { background-color: #9b59b6; }
</style>

    </style>
</head>
<body>
   
        <div class="header-icons d-flex align-items-center">
            <button class="btn text-white"><i class="bi bi-bell-fill fs-5"></i></button>
            <div class="dropdown">
                <button class="btn dropdown-toggle d-flex align-items-center text-white" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="user-icon-circle bg-primary text-white d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px; border-radius: 50%;">
                        <i class="bi bi-person-fill fs-5"></i>
                    </div>
                    <span><%= firstName %> <%= lastName %></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                    <li><h6 class="dropdown-header"><%= employeeId %></h6></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="/CIT_Faculty_setting">Profile</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><form action="/logout" method="POST"><button class="dropdown-item" type="submit">Logout</button></form></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="custom-sidebar">
        <h6>Welcome! <%= firstName %>, <%= lastName %></h6>
        <small><%= employeeId %></small>
        <hr>
        <a href="/CIT_Faculty_dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a>
        <a href="/CIT_Faculty_copus_history"><i class="bi bi-clock-history"></i>Copus History & Results</a>
        <a href="/CIT_Faculty_schedule_management"><i class="bi bi-calendar-event-fill"></i>My Schedule</a>
        <a href="/CIT_Faculty_setting"><i class="bi bi-gear-fill"></i> Account & Profile Settings</a>
        <hr>
        <form action="/logout" method="POST">
            <button type="submit" class="logout-btn">Logout</button>
        </form>
    </div>

    <main class="main-content">
            <div class="custom-card">
                <% if (success_msg && success_msg.length > 0) { %>
                    <div id="successToast" class="alert alert-success d-flex justify-content-between align-items-center" role="alert">
                        <span><%= success_msg %></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>
                <% if (error_msg && error_msg.length > 0) { %>
                    <div id="errorToast" class="alert alert-danger d-flex justify-content-between align-items-center" role="alert">
                        <span><%= error_msg %></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>
                <h2 class="page-title">Available Schedule Slots</h2>
                <div class="search-container mb-4">
                    <input type="text" id="tableSearch" class="form-control" placeholder="Search by date, time, or modality...">
                </div>

                <div class="table-responsive">
                    <table id="availableScheduleTable" class="table custom-table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Details</th>
                                <th>Observers</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (availableSchedules.length === 0) { %>
                                <tr>
                                    <td colspan="5" class="text-center text-muted">No available schedule slots found.</td>
                                </tr>
                            <% } else { %>
                                <% availableSchedules.forEach(schedule => { %>
                                    <tr>
                                        <td class="text-nowrap"><%= new Date(schedule.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %></td>
                                        <td class="text-nowrap"><%= schedule.start_time %> - <%= schedule.end_time %></td>
                                        <td>
                                            <small class="text-muted d-block">Year: <%= schedule.year_level %></small>
                                            <small class="text-muted d-block">Semester: <%= schedule.semester %></small>
                                            <small class="text-muted d-block">School Year: <%= schedule.school_year %></small>
                                            <small class="text-muted d-block">Modality: <%= schedule.modality %></small>
                                        </td>
                                        <td>
                                            <% if (schedule.observers && schedule.observers.length > 0) { %>
                                                <%= schedule.observers.map(observer => observer.observer_name).join(', ') %>
                                            <% } else { %>
                                                N/A
                                            <% } %>
                                        </td>
                                        <td class="text-center">
                                            <button type="button" class="btn btn-sm btn-select"
                                                data-bs-toggle="modal" data-bs-target="#selectScheduleModal"
                                                onclick="openSelectScheduleModal(
                                                    '<%= schedule._id %>',
                                                    '<%= new Date(schedule.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>',
                                                    '<%= schedule.start_time %>',
                                                    '<%= schedule.end_time %>',
                                                    '<%= schedule.year_level %>',
                                                    '<%= schedule.semester %>',
                                                    '<%= schedule.school_year %>',
                                                    '<%= schedule.modality %>',
                                                    '<%= schedule.observers && schedule.observers.length > 0 ? JSON.stringify(schedule.observers.map(o => o.observer_name)) : '[]' %>',
                                                    '<%= schedule.observers && schedule.observers.length > 0 ? JSON.stringify(schedule.observers.map(o => o._id)) : '[]' %>'
                                                )">
                                                Select
                                            </button>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <nav id="pagination-container" class="mt-4 d-flex justify-content-center" aria-label="Page navigation">
                    <ul class="pagination"></ul>
                </nav>
            </div>
        </div>
    </div>

    <div class="modal fade" id="selectScheduleModal" tabindex="-1" aria-labelledby="selectScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="selectScheduleForm" action="/faculty/schedule/select/" method="POST">
                    <div class="modal-header">
                        <h5 class="modal-title" id="selectScheduleModalLabel">Confirm Schedule Selection</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="modalScheduleId" name="scheduleId">
                        <input type="hidden" id="modalObserverIds" name="observerIds">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="text-primary border-bottom border-primary pb-2">Schedule Details</h6>
                                <div class="mb-2">
                                    <label class="form-label mb-0">Date:</label>
                                    <p class="form-control-plaintext text-white" id="modalDate"></p>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label mb-0">Time:</label>
                                    <p class="form-control-plaintext text-white" id="modalTime"></p>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label mb-0">Modality:</label>
                                    <p class="form-control-plaintext text-white" id="modalModality"></p>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label mb-0">Observers:</label>
                                    <p class="form-control-plaintext text-white" id="modalObservers"></p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h6 class="text-primary border-bottom border-primary pb-2">Your Information</h6>
                                <div class="mb-2">
                                    <label class="form-label mb-0">Faculty:</label>
                                    <p class="form-control-plaintext text-white" id="modalFacultyName"><%= firstName %> <%= lastName %></p>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label mb-0">Department:</label>
                                    <p class="form-control-plaintext text-white" id="modalFacultyDepartment"><%= department %></p>
                                </div>
                            </div>
                        </div>
                        <h6 class="text-primary border-bottom border-primary pb-2 mt-4">Required Details</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="subjectCode" class="form-label">Subject Code <span class="text-danger">*</span></label>
                                <select class="form-select" id="subjectCode" name="subjectCode" required>
                                    <option value="">Select Subject Code</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="subjectName" class="form-label">Subject Name <span class="text-danger">*</span></label>
                                <select class="form-select" id="subjectName" name="subjectName" required>
                                    <option value="">Select Subject Name</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="room" class="form-label">Room <span class="text-danger">*</span></label>
                                <select class="form-select" id="room" name="room" required>
                                    <option value="">Select Room</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="copusType" class="form-label">Copus Type</label>
                                <input type="text" class="form-control" id="copusType" name="copusType" readonly>
                                <small class="text-muted">Determined by your observation history.</small>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Confirm Selection</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data and helper functions
        const subjectData = {
            "1st Year": {
                "1st Semester": [{ code: "ITE 368", name: "Introduction to Computing" }],
                "2nd Semester": [{ code: "ITE188", name: "Computer Programming 2" }]
            },
            "2nd Year": {
                "1st Semester": [{ code: "ITE 298", name: "Information Management" }],
                "2nd Semester": [{ code: "ITE 393", name: "Application Development & Emerging Tech" }]
            },
            "3rd Year": {
                "1st Semester": [{ code: "ITE 359", name: "Networking 2" }],
                "2nd Semester": [{ code: "ITE 309", name: "Capstone Project and Research 1" }]
            },
            "4th Year": {
                "1st Semester": [{ code: "ITE 310", name: "Capstone Project and Research 2" }],
                "2nd Semester": [{ code: "ITE 311", name: "Information Technology Practicum" }]
            }
        };

        const roomData = ["101", "102", "ComLab1", "ComLab2"];

        // Modal population logic
        function openSelectScheduleModal(id, date, startTime, endTime, yearLevel, semester, schoolYear, modality, observersJSON, observerIdsJSON) {
            document.getElementById('modalScheduleId').value = id;
            document.getElementById('modalObserverIds').value = observerIdsJSON;

            document.getElementById('modalDate').textContent = date;
            document.getElementById('modalTime').textContent = `${startTime} - ${endTime}`;
            document.getElementById('modalModality').textContent = modality;

            const observers = JSON.parse(observersJSON);
            document.getElementById('modalObservers').textContent = observers.length > 0 ? observers.join(', ') : 'N/A';

            const subjectCodeSelect = document.getElementById('subjectCode');
            const subjectNameSelect = document.getElementById('subjectName');
            const roomSelect = document.getElementById('room');

            subjectCodeSelect.innerHTML = '<option value="">Select Subject Code</option>';
            subjectNameSelect.innerHTML = '<option value="">Select Subject Name</option>';
            roomSelect.innerHTML = '<option value="">Select Room</option>';

            const subjects = subjectData[yearLevel]?.[semester] || [];
            subjects.forEach(subject => {
                const codeOption = new Option(subject.code, subject.code);
                subjectCodeSelect.add(codeOption);
                const nameOption = new Option(subject.name, subject.name);
                subjectNameSelect.add(nameOption);
            });

            roomData.forEach(room => {
                const roomOption = new Option(room, room);
                roomSelect.add(roomOption);
            });

            // Sync selections
            subjectCodeSelect.addEventListener('change', () => {
                const selectedCode = subjectCodeSelect.value;
                const subject = subjects.find(s => s.code === selectedCode);
                subjectNameSelect.value = subject ? subject.name : "";
            });
            subjectNameSelect.addEventListener('change', () => {
                const selectedName = subjectNameSelect.value;
                const subject = subjects.find(s => s.name === selectedName);
                subjectCodeSelect.value = subject ? subject.code : "";
            });
        }

        // Search and Pagination logic
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('tableSearch');
            const tableBody = document.querySelector('#availableScheduleTable tbody');
            const paginationContainer = document.querySelector('#pagination-container .pagination');
            const originalRows = Array.from(tableBody.querySelectorAll('tr'));
            let filteredRows = [...originalRows];
            let currentPage = 1;
            const rowsPerPage = 10;

            function renderTableAndPagination() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                filteredRows = originalRows.filter(row => row.textContent.toLowerCase().includes(searchTerm));

                const noResultsMessage = '<td colspan="5" class="text-center text-muted">No matching schedules found.</td>';
                if (filteredRows.length === 0) {
                    tableBody.innerHTML = `<tr>${noResultsMessage}</tr>`;
                    paginationContainer.innerHTML = '';
                    return;
                }

                tableBody.innerHTML = '';
                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;
                const paginatedRows = filteredRows.slice(start, end);
                paginatedRows.forEach(row => tableBody.appendChild(row));

                renderPagination(Math.ceil(filteredRows.length / rowsPerPage));
            }

            function renderPagination(totalPages) {
                paginationContainer.innerHTML = '';
                if (totalPages <= 1) return;

                const createPageItem = (page, text, disabled = false) => {
                    const li = document.createElement('li');
                    li.classList.add('page-item');
                    if (page === currentPage) li.classList.add('active');
                    if (disabled) li.classList.add('disabled');

                    const a = document.createElement('a');
                    a.classList.add('page-link');
                    a.href = '#';
                    a.textContent = text;
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (!disabled) {
                            currentPage = page;
                            renderTableAndPagination();
                        }
                    });
                    li.appendChild(a);
                    return li;
                };

                paginationContainer.appendChild(createPageItem(currentPage - 1, 'Previous', currentPage === 1));
                for (let i = 1; i <= totalPages; i++) {
                    paginationContainer.appendChild(createPageItem(i, i.toString()));
                }
                paginationContainer.appendChild(createPageItem(currentPage + 1, 'Next', currentPage === totalPages));
            }

            searchInput.addEventListener('keyup', () => {
                currentPage = 1;
                renderTableAndPagination();
            });

            renderTableAndPagination();
        });
    </script>
    </main>
</body>
</html>