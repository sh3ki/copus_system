<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Observer Copus Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* --- Root Variables --- */
:root {
  --primary-color-start: #0f2027; /* Dark blue */
  --primary-color-end: #203a43; /* Darker blue */
  --secondary-color-start: #2c5364; /* Blue-green */
  --secondary-color-end: #203a43; /* Darker blue */
  --text-light: #e0e0e0;
  --text-dark: #333;
  --sidebar-width: 280px;
  --accent-color: #17e891; /* A vibrant green for accents */
  --danger-color: #e74c3c; /* Red for logout/cancel */
  --card-bg-transparent: rgba(255, 255, 255, 0.05);
  --border-color: rgba(255, 255, 255, 0.1);
  --card-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  --button-hover-shadow: 0 4px 10px rgba(23, 232, 145, 0.3);
}

/* --- General Body & Container Styles --- */
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, var(--primary-color-start), var(--primary-color-end));
  color: var(--text-light);
  min-height: 100vh;
  margin: 0;
  display: flex;
  position: relative;
}

/* --- Sidebar --- */
.custom-sidebar {
  width: var(--sidebar-width);
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  background: linear-gradient(to bottom, #101c23, #0f2027);
  color: var(--text-light);
  padding: 2rem 1.5rem;
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
  z-index: 1001;
}

.custom-sidebar h6 {
  font-size: 1.2rem;
  font-weight: 600;
  color: #fff;
  margin-bottom: 0.25rem;
}

.custom-sidebar small {
  color: rgba(255, 255, 255, 0.6);
}

.custom-sidebar hr {
  border-color: rgba(255, 255, 255, 0.1);
  margin: 1.5rem 0;
}

.custom-sidebar a {
  color: var(--text-light);
  text-decoration: none;
  padding: 0.75rem 1rem;
  margin-bottom: 0.5rem;
  border-radius: 8px;
  transition: background 0.3s, color 0.3s;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.custom-sidebar a i {
  font-size: 1.25rem;
}

.custom-sidebar a:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--accent-color);
}

.custom-sidebar a.active {
  background: linear-gradient(to right, #2c5364, #203a43);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  color: #fff;
}

.logout-btn {
  background: linear-gradient(to right, #e74c3c, #c0392b);
  border: none;
  color: #fff;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  text-align: left;
  width: 100%;
  font-weight: 600;
  transition: transform 0.2s, box-shadow 0.2s;
  margin-top: auto; /* Push the logout button to the bottom */
}

.logout-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

/* --- Main Content & Page Layout --- */
.page-container {
  display: flex;
  width: 100%;
}

.main-content {
  margin-left: var(--sidebar-width);
  padding: 2rem 3rem;
  flex-grow: 1;
}

.main-content h1 {
  font-size: 2.5rem;
  font-weight: 700;
  color: #fff;
  margin-bottom: 2rem;
  border-bottom: 3px solid var(--accent-color);
  padding-bottom: 0.5rem;
}

/* --- Search Bar --- */
#searchInput {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  color: var(--text-light);
  padding: 0.75rem 1rem;
  border-radius: 8px;
  width: 100%;
  max-width: 400px;
  margin-bottom: 2rem;
  transition: all 0.3s;
}

#searchInput::placeholder {
  color: rgba(224, 224, 224, 0.5);
}

#searchInput:focus {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 0 0.25rem rgba(23, 232, 145, 0.25);
}

/* --- Card Styles --- */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 2rem;
}

.card {
  background: var(--card-bg-transparent);
  backdrop-filter: blur(5px);
  border: 1px solid var(--border-color);
  border-radius: 15px;
  padding: 2rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  transition: transform 0.2s, box-shadow 0.3s;
  box-shadow: var(--card-box-shadow);
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.card .info p {
  margin-bottom: 0.5rem;
  font-size: 0.95rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card .info p strong {
  font-weight: 600;
  color: #fff;
  flex-shrink: 0;
  margin-right: 1rem;
}

.card .info .blue {
  color: var(--accent-color);
  font-weight: 500;
}

/* --- Buttons in Cards --- */
.result-btn,
.schedule-btn {
  width: 100%;
  padding: 0.75rem;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  margin-top: 1rem;
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
}

.result-btn {
  background: linear-gradient(to right, #2c5364, #203a43);
  color: #fff;
}

.result-btn:hover {
  background: linear-gradient(to right, #17e891, #17c87c);
  color: var(--text-dark);
  transform: translateY(-2px);
  box-shadow: var(--button-hover-shadow);
}

.schedule-btn {
  background: linear-gradient(to right, #17e891, #17c87c);
  color: var(--text-dark);
}

.schedule-btn:hover {
  background: linear-gradient(to right, #2c5364, #203a43);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: var(--button-hover-shadow);
}

/* --- Modal Styles --- */
.modal-content {
  background-color: var(--primary-color-start);
  color: var(--text-light);
  border: 1px solid var(--border-color);
  border-radius: 15px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
}

.modal-header {
  background: linear-gradient(to right, #2c5364, #203a43);
  border-bottom: none;
  border-top-left-radius: 15px;
  border-top-right-radius: 15px;
  color: #fff;
}

.modal-header .btn-close {
  filter: invert(1);
}

.modal-body {
  padding: 2rem;
}

.modal-footer {
  border-top: 1px solid var(--border-color);
}

/* --- Form Input Styles in Modal --- */
.form-control,
.form-select {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  color: var(--text-light);
  transition: all 0.3s;
}

.form-control::placeholder {
  color: rgba(224, 224, 224, 0.5);
}

.form-control:focus,
.form-select:focus {
  background: rgba(255, 255, 255, 0.1);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 0.25rem rgba(23, 232, 145, 0.25);
  color: var(--text-light);
}

.btn-primary, .btn-secondary {
  font-weight: 600;
  transition: transform 0.2s, box-shadow 0.2s;
}

.btn-primary {
  background: linear-gradient(to right, #2c5364, #203a43);
  border: none;
  color: #fff;
}

.btn-primary:hover {
  background: linear-gradient(to right, #17e891, #17c87c);
  color: var(--text-dark);
  transform: translateY(-2px);
  box-shadow: var(--button-hover-shadow);
}

.btn-secondary {
  background: #6c757d;
  border: none;
  color: #fff;
}

.btn-secondary:hover {
  background: #5a6268;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(108, 117, 125, 0.3);
}

/* --- No Results Message --- */
.main-content > p {
  text-align: center;
  margin-top: 5rem;
  font-size: 1.2rem;
  color: rgba(224, 224, 224, 0.7);
}

/* --- Charts Section --- */
.charts-section {
  margin-bottom: 2rem;
}

.chart-card {
  background: var(--card-bg-transparent);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 1.5rem;
  border: 1px solid var(--border-color);
  box-shadow: var(--card-box-shadow);
  height: 300px;
}

.chart-card h5 {
  color: var(--text-light);
  margin-bottom: 1rem;
  font-weight: 600;
  text-align: center;
}

.chart-card canvas {
  max-width: 100%;
  max-height: 200px;
}
  </style>
</head>
<body>
    <div class="page-container">
        <!-- Sidebar -->
        <div class="custom-sidebar">
            <h6>Welcome, <%= firstName %> <%= lastName %></h6>
            <small><%= employeeId %></small>
           <hr />
            <a href="/Observer_dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a>
            <a href="/Observer_copus_result"><i class="bi bi-people-fill"></i> Copus Result</a>
            <a href="/Observer_copus_history"><i class="bi bi-calendar-event-fill"></i> Copus History</a>
            <a href="/Observer_copus_appointments"><i class="bi bi-calendar-check"></i> COPUS Appointments</a>
         <a href="/observer_schedule_management"><i class="bi bi-clipboard-data"></i>Copus & Schedule</a>
            <a href="/Observer_setting"><i class="bi bi-gear-fill"></i> Settings</a>
            <hr />
            <form action="/logout" method="POST">
                <button type="submit" class="logout-btn">Logout</button>
            </form>
        </div> ¬† ¬† ¬†
        <main class="main-content">
            <h1>COPUS RESULT</h1>

<div class="row mb-4">
          <div class="col-md-3">
            <label for="yearLevelFilter" class="form-label">Filter by Year Level</label>
            <select id="yearLevelFilter" class="form-select">
              <option value="">All Year</option>
              <option value="1st year">2025</option>
              <option value="2nd year">2026</option>
              <option value="3rd year">2027</option>
              <option value="4th year">2028</option>
              <option value="5th year">2029</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="semesterFilter" class="form-label">Filter by Semester</label>
            <select id="semesterFilter" class="form-select">
              <option value="">All Semesters</option>
              <option value="1">Semester 1</option>
              <option value="2">Semester 2</option>
              <option value="3">Semester 3</option>
            </select>
          </div>
          <!-- ‚úÖ NEW Phase Filter -->
          <div class="col-md-3">
            <label for="phaseFilter" class="form-label">Filter by Phase</label>
            <select id="phaseFilter" class="form-select">
              <option value="">All Phases</option>
              <option value="p1">P1</option>
              <option value="p2">P2</option>
              <option value="p3">P3</option>
            </select>
          </div>
        </div>
            <!-- Charts Section -->
            <div class="charts-section" style="margin-bottom: 2rem;">
                <div class="row">
                  
                    <!-- Top 1 Overall Score -->
                    <div class="col-md-4 mb-3">
                        <div class="chart-card">
                            <h5>üèÜ Top Overall Score</h5>
                            <canvas id="topOverallChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- Top 10 Highest Scores -->
                    <div class="col-md-4 mb-3">
                        <div class="chart-card">
                            <h5>üìà Top 10 Highest Scores</h5>
                            <canvas id="topHighestChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- Top 10 Lowest Scores -->
                    <div class="col-md-4 mb-3">
                        <div class="chart-card">
                            <h5>üìâ Top 10 Lowest Scores</h5>
                            <canvas id="topLowestChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cards">
                <% if (completedSchedules && completedSchedules.length > 0) { %>
                    <% completedSchedules.forEach(schedule => { %>
                        <div
                            class="card"
                            data-fullname="<%= schedule.fullname.toLowerCase() %>" >
                            <div class="info">
                                <p><strong>Name:</strong> <%= schedule.fullname %></p>
                                <p><strong>Department:</strong> <%= schedule.department %></p>
                                <p>
                                    <strong>Date:</strong>
                                    <span class="blue"><%= schedule.date %></span>
                                </p>
                                <p><strong>Start Time:</strong> <%= schedule.start_time %></p>
                                <p><strong>End Time:</strong> <%= schedule.end_time %></p>
                                <p><strong>Year Level:</strong> <%= schedule.year_level %></p>
                                <p><strong>Semester:</strong> <span class="blue"><%= schedule.semester %></span></p>
                                <p><strong>Subject Code:</strong> <span class="blue"><%= schedule.subject_code %></span></p>
                                <p><strong>Subject Name:</strong> <span class="blue"><%= schedule.subject %></span></p>
                                <p><strong>Observer:</strong> <span class="blue"><%= schedule.observer %></span></p>
                                <p><strong>Copus:</strong> <span class="blue">Copus <%= schedule.copusNumber %></span></p> <p><strong>Modality:</strong> <%= schedule.modality %></p>
                            </div>

                            <%
                                // Construct the result route using the observationId
                                // The route will be /observer_copus_resultX/:observationId
                                let resultRoute = `/observer_copus_result${schedule.copusNumber}/${schedule.observationId}`;
                            %>

                            <form action="<%= resultRoute %>" method="get">
                                <button type="submit" class="result-btn">VIEW RESULT</button>
                                <button
                                    type="button"
                                    class="schedule-btn"
                                    data-bs-toggle="modal"
                                    data-bs-target="#scheduleAppointmentModal"
                                    data-name="<%= schedule.fullname %>"
                                >
                                    SCHEDULE APPOINTMENT
                                </button>
                            </form>
                        </div>
                    <% }); %>
                <% } else { %>
                
                <% } %>
            </div>
        </main>
        
        <!-- Schedule Appointment Modal -->
        <div
            class="modal fade"
            id="scheduleAppointmentModal"
            tabindex="-1"
            aria-labelledby="scheduleAppointmentModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="scheduleAppointmentModalLabel">Schedule New Appointment</h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <form id="scheduleAppointmentForm" method="POST" action="/observer_schedule_appointment">
                            <div class="mb-3">
                                <label for="facultyName" class="form-label">Faculty Name</label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="facultyName"
                                    name="facultyName" placeholder="Enter faculty name"
                                    readonly
                                />
                            </div>
                            <div class="mb-3">
                                <label for="appointmentDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="appointmentDate" name="appointmentDate" required/>
                            </div>
                            <div class="mb-3">
                                <label for="appointmentTime" class="form-label">Time</label>
                                <input type="time" class="form-control" id="appointmentTime" name="appointmentTime" required/>
                            </div>
                            <div class="mb-3">
                                <label for="discussionTopic" class="form-label">Discussion Topic</label>
                                <textarea
                                    class="form-control"
                                    id="discussionTopic"
                                    name="discussionTopic" rows="3"
                                ></textarea>
                            </div>
                            <input type="hidden" name="observerId" value="<%= user._id %>">
                            <input type="hidden" name="observerName" value="<%= user.firstName + ' ' + user.lastName %>">
                            <button type="submit" class="btn btn-primary">Submit Appointment</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification Modal -->
        <div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="notificationModalLabel">Notifications</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>You have no new notifications.</p>
                        <p>Example: New COPUS result for [Faculty Name] is available.</p>
                        <p>Example: Appointment scheduled with [Faculty Name] on [Date] at [Time].</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">View All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Placeholder for local JavaScript file, since it cannot be included
        // import '/js/Observer/copus_result.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Logic to populate the modal with the selected faculty name
            document.querySelectorAll('.schedule-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const name = button.getAttribute('data-name');
                    document.getElementById('facultyName').value = name;
                });
            });
            
            // Logic for the search bar
            const searchInput = document.getElementById('searchInput');
            const cards = document.querySelectorAll('.cards .card');
            
            searchInput.addEventListener('input', function () {
                const query = this.value.toLowerCase();
                cards.forEach(card => {
                    const fullname = card.getAttribute('data-fullname');
                    if (fullname.includes(query)) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            // Initialize Charts
            const chartData = <%- JSON.stringify(chartData || { topHighest: [], topLowest: [], topOverall: null }) %>;
            
            // Create Top Overall Score Chart
            if (chartData.topOverall) {
                const topOverallCtx = document.getElementById('topOverallChart').getContext('2d');
                new Chart(topOverallCtx, {
                    type: 'bar',
                    data: {
                        labels: [chartData.topOverall.faculty_name || 'N/A'],
                        datasets: [{
                            label: 'Score (%)',
                            data: [chartData.topOverall.overall_percentage || 0],
                            backgroundColor: '#17e891',
                            borderColor: '#15d084',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: `${chartData.topOverall.overall_percentage || 0}% - ${chartData.topOverall.final_rating || 'N/A'}`,
                                color: '#e0e0e0'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { color: '#e0e0e0' },
                                grid: { color: 'rgba(224, 224, 224, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#e0e0e0' },
                                grid: { color: 'rgba(224, 224, 224, 0.1)' }
                            }
                        }
                    }
                });
            }
            
            // Create Top 10 Highest Scores Chart
            if (chartData.topHighest && chartData.topHighest.length > 0) {
                const topHighestCtx = document.getElementById('topHighestChart').getContext('2d');
                new Chart(topHighestCtx, {
                    type: 'bar',
                    data: {
                        labels: chartData.topHighest.map(item => item.faculty_name || 'N/A'),
                        datasets: [{
                            label: 'Score (%)',
                            data: chartData.topHighest.map(item => item.overall_percentage || 0),
                            backgroundColor: '#28a745',
                            borderColor: '#20c997',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { color: '#e0e0e0', font: { size: 10 } },
                                grid: { color: 'rgba(224, 224, 224, 0.1)' }
                            },
                            x: {
                                ticks: { 
                                    color: '#e0e0e0', 
                                    font: { size: 8 },
                                    maxRotation: 45
                                },
                                grid: { color: 'rgba(224, 224, 224, 0.1)' }
                            }
                        }
                    }
                });
            }
            
            // Create Top 10 Lowest Scores Chart
            if (chartData.topLowest && chartData.topLowest.length > 0) {
                const topLowestCtx = document.getElementById('topLowestChart').getContext('2d');
                new Chart(topLowestCtx, {
                    type: 'bar',
                    data: {
                        labels: chartData.topLowest.map(item => item.faculty_name || 'N/A'),
                        datasets: [{
                            label: 'Score (%)',
                            data: chartData.topLowest.map(item => item.overall_percentage || 0),
                            backgroundColor: '#dc3545',
                            borderColor: '#e74c3c',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { color: '#e0e0e0', font: { size: 10 } },
                                grid: { color: 'rgba(224, 224, 224, 0.1)' }
                            },
                            x: {
                                ticks: { 
                                    color: '#e0e0e0', 
                                    font: { size: 8 },
                                    maxRotation: 45
                                },
                                grid: { color: 'rgba(224, 224, 224, 0.1)' }
                            }
                        }
                    }
                });
            }
            
            // --- JavaScript to show the success/error modal based on passed variables ---
            // Get messages passed from the server
            const successMessage = `<%= typeof successMessage !== 'undefined' ? successMessage : '' %>`;
            const errorMessage = `<%= typeof errorMessage !== 'undefined' ? errorMessage : '' %>`;
            
            // Handle Success Modal
            if (successMessage && successMessage.trim().length > 0) {
                const successModalElement = document.getElementById('successModal');
                const successMessageContent = document.getElementById('successMessageContent');
                if (successModalElement && successMessageContent) {
                    successMessageContent.textContent = successMessage;
                    const successModal = new bootstrap.Modal(successModalElement);
                    successModal.show();
                }
            }
            
            // Handle Error Modal
            if (errorMessage && errorMessage.trim().length > 0) {
                const errorModalElement = document.getElementById('errorModal');
                const errorMessageContent = document.getElementById('errorMessageContent');
                if (errorModalElement && errorMessageContent) {
                    errorMessageContent.textContent = errorMessage;
                    const errorModal = new bootstrap.Modal(errorModalElement);
                    errorModal.show();
                }
            }
        });
    </script>
</body>
</html>

