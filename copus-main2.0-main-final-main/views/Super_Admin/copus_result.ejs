<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary-color-start: #0f2027;
      --primary-color-end: #203a43;
      --text-light: #e0e0e0;
      --accent-color: #17e891;
      --sidebar-width: 260px;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--primary-color-start), var(--primary-color-end));
      color: var(--text-light);
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
    }

     .custom-sidebar {
            width: var(--sidebar-width);
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
           background: linear-gradient(to bottom, #11405b, #0f2027);
            color: var(--text-light);
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            width: 15%;
        }

        .custom-sidebar h6 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.25rem;
        }

        .custom-sidebar small {
            color: rgba(255, 255, 255, 0.6);
        }

        .custom-sidebar hr {
            border-color: rgba(255, 255, 255, 0.1);
            margin: 1.5rem 0;
        }

        .custom-sidebar a {
            color: var(--text-light);
            text-decoration: none;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            transition: background 0.3s, color 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: bold;
        }

        .custom-sidebar a i {
            font-size: 1.25rem;
        }

        .custom-sidebar a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-color);
        }

        .custom-sidebar a.active {
            background: linear-gradient(to right, #2c5364, #203a43);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            color: #fff;
        }

        .logout-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            border: none;
            color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            text-align: left;
            width: 100%;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /*
    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      padding: 2.5rem 3rem 2.5rem 2rem; /* ðŸ”¹ added more right padding space */
      overflow-x: hidden;
    }

    .dashboard-title {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 1.8rem;
      text-align: left;
      margin-left: 30px;
    }

    /* Dashboard Cards */
    .dashboard-cards {
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      margin-left: 30px;
    }

    .dashboard-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      width: 240px;
      height: 130px;
      padding: 1.5rem;
      color: #fff;
      text-align: left;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s, box-shadow 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .dashboard-card h6 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .dashboard-card p {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-color);
    }

    /* Table Section */
    .table-section {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 1.5rem 2rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      max-width: 95%; /* ðŸ”¹ make it narrower */
      margin-left: 30px; /* ðŸ”¹ align slightly with cards */
      width: 86%;
    }

    .table-section h4 {
      margin-bottom: 1rem;
      color: #fff;
      font-weight: 600;
    }

    .custom-table {
      color: #fff;
      border-collapse: separate;
      border-spacing: 0 8px;
      width: 100%;
    }

    .custom-table thead th {
      background: rgba(255, 255, 255, 0.15);
      border: none;
      padding: 10px 12px;
      text-align: left;
      border-radius: 10px;
    }

    .custom-table tbody tr {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      transition: background 0.3s;
    }

    .custom-table tbody tr:hover {
      background: rgba(255, 255, 255, 0.12);
    }

    .custom-table td {
      padding: 10px 12px;
      vertical-align: middle;
    }

    @media (max-width: 768px) {
      .main-content {
        margin-left: 0;
        padding: 2rem 1rem;
      }
      .dashboard-card {
        width: 100%;
      }
      .table-section {
        max-width: 100%;
        margin-left: 0;
      }
    }
    .section-divider {
  border: none;
  height: 2px;
  background: linear-gradient(to right, #17e891, transparent);
  margin: 2rem 0 1rem 0; /* adjust spacing between cards and table */
  border-radius: 5px;
  margin-left: 30px;
}

  </style>
</head>
<body>
  <div class="container-fluid p-0">
    <div class="row g-0">
      
<!-- Sidebar -->
<div class="custom-sidebar">
  <h6>Welcome, <%= firstName %> <%= lastName %></h6>
  <small>Employee ID: <%= employeeId %></small>
  <hr>
  <a href="/super_admin_copus_result" class="active"><i class="bi bi-clipboard-data"></i> Dashboard</a>
  <a href="/super_admin_user_management"><i class="bi bi-people-fill"></i> User Management</a>
  <a href="/super_admin_schedule"><i class="bi bi-calendar-event-fill"></i>  Copus & Schedule</a>
  <a href="/super_admin_copus_history"><i class="bi bi-clock-history"></i> Copus History</a>
  <a href="/super_admin_copus_appointments"><i class="bi bi-calendar-check"></i> COPUS Appointments</a>
  <a href="/super_admin_setting"><i class="bi bi-gear-fill"></i> Account & Profile Settings</a>
  <hr>
  <form action="/logout" method="POST">
    <button type="submit" class="logout-btn">Logout</button>
  </form>
</div>

 <!-- Main Content -->
<main class="main-content">
  <h2 class="dashboard-title">Super Admin Dashboard</h2>

  <!-- Dashboard Cards -->
  <div class="dashboard-cards">
    <div class="dashboard-card">
      <h6>Total Upcoming<%= filterLabel %></h6>
      <p><%= totalUpcoming %></p>
    </div>

    <div class="dashboard-card">
      <h6>Total Users</h6>
      <p><%= totalUsers %></p>
    </div>

    <div class="dashboard-card">
      <h6>Completed COPUS<%= filterLabel %></h6>
      <p><%= totalCompleted %></p>
    </div>
     <div class="dashboard-card">
      <h6>Faculty Teachers</h6>
      <p><%= totalFaculty %></p>
    </div>
  </div>
  
  <!-- Divider Line -->
<hr class="section-divider">
<!-- Top 10 Teachers Section -->
<div class="table-section">
  <h4><i class="bi bi-trophy-fill text-warning"></i> Top 10 Teachers</h4>

  <!-- Filter Controls -->
  <div class="row mb-3">
    <div class="col-md-3">
      <label for="semFilter" class="form-label">Filter by Semester</label>
      <select id="semFilter" class="form-select" onchange="applyFilters()">
        <option value="All Semesters" <%= selectedSemester === 'All Semesters' ? 'selected' : '' %>>All Semesters</option>
        <% semesters.forEach(semester => { %>
          <option value="<%= semester %>" <%= selectedSemester === semester ? 'selected' : '' %>><%= semester %></option>
        <% }); %>
      </select>
    </div>

    <div class="col-md-3">
      <label for="yearFilter" class="form-label">Filter by Year</label>
      <select id="yearFilter" class="form-select" onchange="applyFilters()">
        <option value="All Years" <%= selectedYear === 'All Years' ? 'selected' : '' %>>All Years</option>
        <% years.forEach(year => { %>
          <option value="<%= year %>" <%= selectedYear === year ? 'selected' : '' %>><%= year %></option>
        <% }); %>
      </select>
    </div>

    <div class="col-md-6">
      <label for="subjectFilter" class="form-label">Filter by Subject</label>
      <select id="subjectFilter" class="form-select" onchange="applyFilters()">
        <option value="All Subjects" <%= selectedSubject === 'All Subjects' ? 'selected' : '' %>>All Subjects</option>
        <% subjects.forEach(subject => { %>
          <option value="<%= subject %>" <%= selectedSubject === subject ? 'selected' : '' %>><%= subject %></option>
        <% }); %>
      </select>
    </div>
  </div>

  <script>
    function applyFilters() {
      const semester = document.getElementById('semFilter').value;
      const year = document.getElementById('yearFilter').value;
      const subject = document.getElementById('subjectFilter').value;
      
      // Build query string
      const params = new URLSearchParams();
      if (semester && semester !== 'All Semesters') params.append('semester', semester);
      if (year && year !== 'All Years') params.append('year', year);
      if (subject && subject !== 'All Subjects') params.append('subject', subject);
      
      // Reload page with filters
      window.location.href = '/super_admin_copus_result' + (params.toString() ? '?' + params.toString() : '');
    }
  </script>

 <!-- Table -->
<div class="table-responsive">
  <table class="custom-table" id="topTeachersTable">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Teacher Name</th>
        <th>Subject</th>
        <th>Sem</th>
        <th>Year</th>
        <th>Department</th>
        <th>Student Action Average</th>
        <th>Teacher Action Average</th>
        <th>Final Rating</th>
      </tr>
    </thead>
    <tbody>
      <% if (topTeachers && topTeachers.length > 0) { %>
        <% topTeachers.forEach((teacher, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td>
              <% if (index === 0) { %>
                <i class="bi bi-trophy-fill text-warning me-2"></i>
              <% } else if (index === 1) { %>
                <i class="bi bi-trophy-fill text-secondary me-2"></i>
              <% } else if (index === 2) { %>
                <i class="bi bi-trophy-fill text-danger me-2"></i>
              <% } %>
              <%= teacher.faculty_name %>
            </td>
            <td><%= teacher.subject %></td>
            <td><%= teacher.semester %></td>
            <td><%= teacher.year %></td>
            <td><%= teacher.department %></td>
            <td><%= teacher.student_action_avg %>%</td>
            <td><%= teacher.teacher_action_avg %>%</td>
            <td><%= teacher.overall_avg %>%</td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="9" class="text-center">No COPUS results available yet. Complete observations to see rankings.</td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const filters = {
      sem: document.getElementById("semFilter"),
      year: document.getElementById("yearFilter"),
      subject: document.getElementById("subjectFilter"),
    };

    const tableBody = document.querySelector("#topTeachersTable tbody");

    function applyFilters() {
      const semValue = filters.sem.value.trim().toLowerCase();
      const yearValue = filters.year.value.trim().toLowerCase();
      const subjectValue = filters.subject.value.trim().toLowerCase();

      // Loop through each row and check if it matches all filters
      for (const row of tableBody.rows) {
        const sem = row.cells[3].textContent.trim().toLowerCase();
        const year = row.cells[4].textContent.trim().toLowerCase();
        const subject = row.cells[2].textContent.trim().toLowerCase();

        const matches =
          (semValue === "" || sem.includes(semValue)) &&
          (yearValue === "" || year.includes(yearValue)) &&
          (subjectValue === "" || subject.includes(subjectValue));

        row.style.display = matches ? "" : "none";
      }
    }

    // Attach one event listener for all filters
    Object.values(filters).forEach(filter =>
      filter.addEventListener("change", applyFilters)
    );
  });
</script>

<!-- Bootstrap JS (required for modal functionality) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Include Account Activation Modal (shows first) -->
<%- include('../partials/account-activation-modal') %>

<!-- Include First-Login Modal (shows after activation) -->
<%- include('../partials/first-login-modal') %>

</body>
</html>
